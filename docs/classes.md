# Архитектура приложения

Проект построен по принципам ООП и разделён на логические модули.

## Структура проекта

```
project-heart-risk-prediction/
├── src/
│   ├── app/            # FastAPI-приложение
│   └── core/           # Ядро модели и препроцессинга
├── docs/               # Документация
├── tests/              # Тесты
├── model.pkl           # Сохранённая модель CatBoost
├── label_encoder.pkl   # Сохранённый LabelEncoder для Gender
└── requirements.txt    # Зависимости
```

## Основные классы

### `DataProcessor` (`src/core/data_processor.py`)

**Назначение**: Предобработка входных данных перед предсказанием.

**Методы**:
- `__init__(encoder_path=None)` — инициализация; загружает сохранённый `LabelEncoder` для колонки `Gender`
- `transform(df)` — применяет следующие преобразования:
  - Удаляет служебные колонки: `id`, `Unnamed: 0`
  - Унифицирует значения `Gender` (`'1.0'`, `'0.0'` → `'Male'`, `'Female'`)
  - Кодирует `Gender` в числовой формат (`0`/`1`)
- `fit(df)` — обучает внутренний `LabelEncoder` (используется только при подготовке модели)

**Особенности**:
- Поддерживает воспроизводимость за счёт сохранения `LabelEncoder`
- Безопасен к различным форматам входных данных

### `ModelWrapper` (`src/core/model_wrapper.py`)

**Назначение**: Обёртка над обученной моделью CatBoost для инференса.

**Методы**:
- `__init__(model_path)` — загружает модель из `.pkl` файла
- `predict(X)` — возвращает предсказания в виде `pd.Series` с именем `"prediction"`

**Особенности**:
- Изолирует логику модели от FastAPI-слоя
- Гарантирует корректный тип возвращаемых данных (`int`)

### FastAPI-приложение (`src/app/main.py`)

**Эндпоинты**:
- `/health` — проверка доступности
- `/predict` — основной эндпоинт для предсказаний

**Логика обработки запроса**:
1. Принимает CSV-файл через `multipart/form-data`
2. Читает данные в `pandas.DataFrame`
3. Применяет `DataProcessor.transform()`
4. Выполняет предсказание через `ModelWrapper.predict()`
5. Формирует JSON-ответ с сохранением оригинальных `id`

## Зависимости

- Модель и `LabelEncoder` должны находиться в корне проекта (`model.pkl`, `label_encoder.pkl`)
- Все пути заданы относительно корня проекта
- Для запуска требуется Python 3.8+ и зависимости из `requirements.txt`
```